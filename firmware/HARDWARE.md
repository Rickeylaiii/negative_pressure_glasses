# 硬件连接指南

## ESP32-C3引脚映射表

| 功能 | 引脚号 | 说明 |
|-----|-------|------|
| **SPI - 温度传感器1** | | |
| SCK | GPIO2 | 时钟线（共享） |
| CS1 | GPIO3 | 片选1 |
| MISO | GPIO10 | 数据线（共享） |
| **SPI - 温度传感器2** | | |
| SCK | GPIO2 | 时钟线（共享） |
| CS2 | GPIO4 | 片选2 |
| MISO | GPIO10 | 数据线（共享） |
| **I2C - 压力传感器** | | |
| SDA | GPIO8 | 数据线 |
| SCL | GPIO9 | 时钟线 |
| **PWM - 加热控制** | | |
| HEAT | GPIO5 | 连接MOSFET栅极 |
| **PWM - 泵控制** | | |
| PUMP | GPIO6 | 连接L298N输入 |
| **PWM - 蜂鸣器** | | |
| BUZZER | GPIO18 | 直接驱动或通过三极管 |
| **按键** | | |
| POWER | GPIO19 | 上拉输入 |
| UP | GPIO20 | 上拉输入 |
| DOWN | GPIO21 | 上拉输入 |
| **电源** | | |
| VCC | 5V | USB Type-C供电 |
| GND | GND | 公共地 |

## 详细连接说明

### 1. MAX31855温度传感器模块

```
MAX31855模块1:
  VCC  ----> 3.3V (ESP32)
  GND  ----> GND
  SCK  ----> GPIO2
  CS   ----> GPIO3
  MISO ----> GPIO10

MAX31855模块2 (如果使用):
  VCC  ----> 3.3V (ESP32)
  GND  ----> GND
  SCK  ----> GPIO2 (共享)
  CS   ----> GPIO4
  MISO ----> GPIO10 (共享)

K型热电偶:
  +  ----> MAX31855的T+
  -  ----> MAX31855的T-
```

### 2. XGZ6897d压力传感器

```
XGZ6897d:
  VCC  ----> 5V
  GND  ----> GND
  SDA  ----> GPIO8
  SCL  ----> GPIO9
```

**注意**：如果传感器是5V器件，建议在SDA/SCL线上使用电平转换模块。

### 3. 加热片控制电路

```
ESP32-C3                MOSFET(IRF540N)      加热片
GPIO5 ----[1kΩ]----> Gate                    
                     Source -----> GND       
                     Drain  -----> 加热片(-)  
                                   加热片(+) ----> 5V/12V
```

**重要提示**：
- MOSFET栅极串联1kΩ电阻保护
- Source接GND
- 加热片电源根据实际功率选择（5V或12V）
- 建议添加续流二极管保护

### 4. 真空泵控制（L298N驱动）

```
ESP32-C3          L298N         真空泵
GPIO6  ----> ENA  
5V     ----> IN1             OUT1 ----> 泵(+)
GND    ----> IN2             OUT2 ----> 泵(-)
12V    ----> +12V
GND    ----> GND
```

**配置**：
- ENA接PWM信号控制速度
- IN1=HIGH, IN2=LOW 正转
- 泵电压根据型号选择（3.7V-5V）

### 5. 蜂鸣器

```
ESP32-C3                蜂鸣器(HY9055)
GPIO18 ----[100Ω]----> (+)
                       (-) ----> GND
```

或通过三极管驱动：

```
ESP32-C3      NPN(2N2222)    蜂鸣器
GPIO18 ---[1kΩ]---> Base
                    Emitter --> GND
                    Collector -> 蜂鸣器(-) 
                                 蜂鸣器(+) --> 5V
```

### 6. 按键电路

```
每个按键:
      +3.3V
        |
       10kΩ (可选，ESP32内部上拉)
        |
按键 ---+----> GPIOxx
        |
       GND
```

**说明**：
- 使用内部上拉，按键按下为LOW
- 外部上拉电阻可选（10kΩ）

## 电源系统

### 推荐方案

```
USB Type-C (5V 2A)
    |
    +----> ESP32-C3 (自带稳压)
    |
    +----> L298N (+12V通过升压模块)
    |
    +----> 其他5V器件
```

### 电池供电（可选）

```
18650锂电池 (3.7V)
    |
    +----> 升压模块(5V 2A) ----> 系统
    |
    +----> 充电管理模块 <---- Type-C充电
```

## 调试检查清单

### 上电前检查

- [ ] 所有GND连接正确
- [ ] 电源电压正确（3.3V/5V）
- [ ] 无短路
- [ ] 极性正确

### 传感器测试

- [ ] MAX31855读取环境温度正常
- [ ] 热电偶显示合理温度
- [ ] 压力传感器I2C通讯正常

### 执行器测试

- [ ] 加热片通电测试（低功率）
- [ ] 泵单独测试运转
- [ ] 蜂鸣器发声测试

### 按键测试

- [ ] 按键触发正常
- [ ] 上拉电阻有效
- [ ] 消抖正常

## 安全注意事项

⚠️ **警告**：

1. **加热片**：
   - 首次测试使用低功率
   - 必须有温度监控
   - 添加过温保护

2. **真空泵**：
   - 确认电压匹配
   - 注意噪音控制
   - 定期检查密封

3. **电源**：
   - 使用合适功率的电源
   - 注意散热
   - 添加保险丝

4. **调试**：
   - 分模块测试
   - 逐步增加功率
   - 监控温度和电流

## 故障排除

### 温度传感器无读数

1. 检查SPI连接
2. 确认CS引脚正确
3. 测试热电偶连续性

### 压力传感器无响应

1. 扫描I2C地址
2. 检查电平转换
3. 确认传感器供电

### 加热不工作

1. 测试PWM输出
2. 检查MOSFET导通
3. 测量加热片电阻

### 泵不转

1. 检查L298N使能
2. 测试泵单独供电
3. 确认PWM信号

## 推荐工具

- 万用表（必需）
- 逻辑分析仪（I2C/SPI调试）
- 热成像仪（温度调试）
- 电源分析仪（功耗测试）
